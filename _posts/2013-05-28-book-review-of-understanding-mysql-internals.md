---
layout: post
title: "Understanding MySQL Internals 读后感"
description: "book review"
category: mysql
tags: [Database]
---

花了几天时间读了下Sasha的《Understanding MySQL Internals》，大觉过瘾。如果想研究Mysql源码的话，建议先看这本书呢，可以先构筑一下Mysql的框架体系，并且对各种考量的来龙去脉能有所了解呢。  
PS：PDF电子版是免费的，而且语言很通俗，反正我是无障碍的读下来了。本文只是一些我觉的挺有趣的观点进行阐述，详情请参看这本书。  

----------

## 不使用异常，都通过返回错误码进行校验 ##

mysql中不使用异常，就算实现了异常，编译的时候也会关掉的。对于错误码的描述会定义在一个额外的文件中，并且有多种语言版本。 

----------

## 线程VS进程  ##
mysql服务端接受链接并处理的时候是开线程来做的。创建进程开销较大，并且不利于信息共享。线程最大的困难是对编程要求较高，一个线程挂了，整个进程都要崩溃。不过Mysql的开发者很霸气的说“What an exciting challenge”。结果就显而易见了。

----------

## 存储引擎接口 ##
Mysql也不是生来就支持多种存储引擎的：）。它的统一引擎接口不但规范了数据库的一些通用语义：table,column,row,index。另外还定义了统一的表定义文件格式(.frm)。mysql会在启动的时候读取这个表定义文件，并放入缓存中。

----------

## 鲜为人知的存储引擎 ##
除了古老的MyISAM和名声在外的InnoDB。Mysql还支持下面几种存储引擎：  
***Memory(Heap):*** 内存数据库，以前的名字叫Heap，所以在代码中会出现Heap的文件和定义。这个内存数据库可以定时同步数据到磁盘，当然系统崩溃后，没有同步的数据就丢失。它除了提供Hash索引也提供B-tree索引（用来支持范围查找索引等等），书上说，其实控制好缓存页的大小，B-tree比hash索引的差距没有想象中那么大的。待研究呢...  
***NDB***:网络数据库，算是一种分布式数据库吧。按key值进行划分主机。  
***Archive***: 文档引擎，只能insert和select。酷啊， 好处有两个：空间浪费少+并发度极高。    
***Federated***：这个相信大家没听说过，这个是让用户可以访问数据存储在远端的mysql。其实就是用户访问A主机上的mysql（上面只有表定义文件），实际数据是存放在B主机的mysql上。个人表示没有想到应用场景。

----------

## 主备同步 ##
主备同步分两种：Satement-Based，Row-Based。通俗的讲就是“同步操作”还是“同步数据”。mysql一开始使用的是同步操作，这对要在备机执行SQL的上下文，确定极难控制。所以mysql后来也提供了“同步数据”。现在支持三种方式：Satement-Based，Row-Based，Mixed。（爱咋折腾咋折腾吧）

----------

## 写在最后 ##
另外关于SQL解析，执行计划优化，事务与灾难恢复，这些过于精妙，三言两语说不清，之后另开文章进行阐述。  
总感觉看完这本书后，对Mysql有了更多的感性认识。所以 **一个产品配上一本书，这产品的代码就变得有灵魂了。**




