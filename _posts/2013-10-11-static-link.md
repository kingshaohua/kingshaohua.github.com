---
layout: post
title: "各平台下如何支持静态链接（C++）"
description: "各平台下如何支持静态链接（C++）"
category: 编译
tags: [编译]
---
首次接触动态库和静态库的时候，当时就想动态库这么方便又省空间，谁会去用静态库阿？不过最近遇到一个场景就需要编译静态库：  
我们的产品Q作为独立产品发布，另一个底层框架B，这是可能会提供个全公司使用，我们也想将底层库替换成B。  
但是考虑到产品的独立性与稳定性（框架B还没经过长时间的考验，不稳定，**会导致版本更新较快**）。于是我们将框架B静态编译到我们的产品Q中。这样当其他产品使用较新版本的框架B时，同时使用我们的产品Q（可能使用的某个老版本的框架B）。就不会产生版本不一致问题了。  

## 动态库与静态库 ##
动态库一般以[.so]结尾（HP下以 [.sl]结尾）。静态库一般以[.a]结尾。  

关于动态库，静态库，链接方面的知识，自行google，另外推荐一本书：[《程序员的自我修养:链接、装载与库》](http://book.douban.com/subject/3652388/ "《程序员的自我修养:链接、装载与库》")  ，网上讲的东西都比较零碎，这本书里讲的比较全。  

## 编译链接参数 ##
起初，我认为对于静态库和动态库的链接需要特别指定是使用静态库还是动态库。一下是我找到的一些参考资料： 

比如在AIX下，参考[http://blog.firetree.net/2005/07/21/static-linking-on-aix/](http://blog.firetree.net/2005/07/21/static-linking-on-aix/ "http://blog.firetree.net/2005/07/21/static-linking-on-aix/")  
这个里面就讲到使用-bstatic来开启静态链接，但是在使用完后要用-bdynamic来恢复动态链接选项。（AIX是默认使用动态链接）

另外可以参考：  
[各平台基于GCC的链接库编译小结](http://leander.blog.51cto.com/2911819/1099430 "各平台基于GCC的链接库编译小结")  
 [Unix平台链接库](http://biancheng.dnbcw.info/aix/234618.html "Unix平台链接库")

> 在AIX系统上连接的时候，如果需要联接*.so文件，那么必须在链接的时候，选择–brtl选项。

也就是说，没有-brtl选项，编译器会去找静态库，加了-brtl就会去找动态库和静态库，优先找动态库。于是我把框架B的动态库删了，留下了静态库。什么额外选项也没有加。**编译器就自动找到静态库（[.a]结尾的文件）并静态链接进去了。**  在，HP，SUN，AIX，SUSE下都好用。

## 结论 ##
所以，对于静态库的链接不需要特别的加编译选项，编译器会根据**库文件后缀**来判断是静态链接还是动态链接。
